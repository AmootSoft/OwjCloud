راه اندازی ویپ در اوج ابری (ایزابل)

برای ایجاد ارتباط بین اوج ابری و ویپ ایزابل حتما باید ورژن Asterisk  13 به بعد باشد، زیرا قابلیت Sip Webrtc در ورژن های قبل وجود ندارد.

توجه کنید که ویپ شما باید در اینترنت دردسترس باشد ( آیپی ثابت داشته باشید ) و همچنین قابلیت ssl نیز فعال باشد، پیشنهاد میشود ssl  معتبر باشد و self signed certificated  نباشد.

مرحله اول شما نیاز دارید که داخلی های مورد نظر را با روش webrtc  بسازید :

1. با ادمین وارد پنل شوید > PBX Configuration  سپس در نوار سمت چپ برروی Extensions کلیک کنید.

![](img/img1.png)

1. در صفحه باز شده Device  را روی Sip Webrtc Device  قرار دهید و سپس برروی کلید Submit  کلیک کنید.
1. در این قسمت فیلد های زیر را وارد کنید :
   1. User Extension: داخلی مورد نظر
   1. Display Name: نام نمایشی
   1. Secret: رمزی که برای این Sip Webrtc  در نظر دارید
   1. Nat=Yes
   1. Rtcp\_mux=Yes (توجه کنید اگر این گزینه وجود ندارد ذخیره کنید سپس Sip  را ویرایش کنید در قسمت ویرایش این فیلد اضافه میشود.)

سپس برروی کلید Submit کلیک کنید.

![](img/img2.png)

` `در هنگام ویرایش باید فیلد ها مانند عکس زیر باشد.

![](img/img3.png)

1. در قسمت PBX Configuration  در پنل سمت چپ برروی Advanced Settings  کلیک کنید.

![](img/img4.png)

تنظیمات باید مانند عکس بالا باشند.

1. در کنسول ایزابل از طریق ssh لاگین شوید و دستورات زیر را بزنید
1. ``printf "icesupport=true \n stunaddr=stun.owj.io:80" >> /etc/asterisk/rtp.conf && systemctl restart asterisk``
   1. اگر این دستور به خطا خورد فایل rtp.conf  را باز کنید و این دو خط را اضافه کنید
   1. ``vi /etc/asterisk/rtp.conf`` برای ویرایش فایل از این دستور استفاده کنید
      1. ``icesupport=true``
      1. ``stunaddr=stun.owj.io:80``
   1. پس از افزودن دو خط `:wq ` `Enter` بزنید

سپس این دستور را وارد کنید 

`	`Systemctl restart asterisk

1. با کاربر ادمین در اوج ابری لاگین کنید.
1. در تنظیمات > تنظیمات عمومی  بخش ادغام ها گزینه Asterisk (Voip) را فعال کنید.
1. در فیلد ip سرور PBX آدرس سرور ایزابل را ست کنید.
1. در فیلد Websocket به این روش مقدار را وارد کنید  ``wss://ServerIp Or Domain:8089/ws``
1. فیلد محیط Voip را برروی تولید قرار دهید.
1. سپس ذخیره کنید.

![](img/img5.png)

1. در قسمت تنظیمات > مدیریت کاربران، کاربر مورد نظر را ویرایش کنید
   1. در بخش دوم ( ترجیحات ) بخش پیکربندی VOIP
   1. ورود به سیستم SIP / برنامه افزودنی مرورگر : فیلد User Extension
   1. برنامه افزودنی گوشی : شماره داخلی HardPhone ( اگر فرد داخلی دیگری برای هارد فون دارد در این بخش اضافه شود در غیر اینصورت همان User Extension  را وارد کنید )
   1. گذر واژه SIP: فیلد Secret  در ویپ

![](img/img6.png)

1. پس از ذخیره تغییرات کاربری که تغییرات را برای آن اعمال کردید باید یکبار صفحه خورد را رفرش کند (F5)


خطا یابی :

اطلاعات کاربری شما به درستی تنظیم نشده است. لطفاً با سرپرست خود تماس بگیرید. : اطلاعات کاربر با Sip Webrtc  تداخل دارد ! و User Extension  و Secret  اشتباه وارد شده است.


Uri websocket ممکن است اشتباه باشد. لطفاً پیکربندی خود را بررسی کنید. : این خطا به دلیل عدم ارتباط با وب سوکت میباشد دلایل زیادی دارد که شامل:

1. Firewall Port 8089
1. فیلد Websocket  به درستی وارد نشده !
1. مرحله 4 را چک کنید.
1. ` `اگر ویپ شما ssl Self Signed Certificate  داشته باشد لازم است کاربر یکبار ip  یا دامنه ویپ را داخل مرورگر وارد کند و Certificate  سایت را تایید کند.

پورت های مورد نیاز :

``5060 UDP/TCP``

``10,000-20,000  UDP``
